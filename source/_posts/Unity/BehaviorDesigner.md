---
title: BehaviorDesigner
categories: Unity
date: 2022-10-04 11:50:08
tags: BehaviorDesigner
---

## 行为树基础

### 原理

需要决策当前行为的时候，就会自顶向下，通过一些条件来搜索这棵树，最终确定需要做的行为（叶子节点），并执行它。

### 组成

行为树由以下几点抽象而成：

__组合节点(Composites)__：主要包含：__Sequence顺序条件__，__Selector选择条件__，__Parallel平行条件__以及他们之间相互组合的条件。

__装饰节点(Decorator)__：连接树叶的树枝，就是各种类型的修饰节点，这些节点决定了 AI 如何从树的顶端根据不同的情况，来沿着不同的路径来到最终的叶子这一过程。
如让子节点循环操作（LOOP）或者让子task一直运行直到其返回某个运行状态值（Util），或者将task的返回值取反（NOT）等等

__条件节点(Conditinals)__：用于判断某条件是否成立。目前看来，是Behavior Designer为了贯彻职责单一的原则，将判断专门作为一个节点独立处理，比如判断某目标是否在视野内，其实在攻击的Action里面也可以写，但是这样Action就不单一了，不利于视野判断处理的复用。一般条件节点出现在Sequence控制节点中，其后紧跟条件成立后的Action节点。

行为节点(Action)：行为节点是真正做事的节点，行为节点在树的最末端，都是叶子节点，就是这些 AI 实际上去做事情的命令；

### 遍历

行为树的一个特点是，它会“一层一层”地去对节点依次进行检查，而这每一层都需要花费一个 tick 的时间，所以它需要花数个 tick 才能完成从顶部走到底的过程，来完成其逻辑，这和一般用代码实现功能是很不同的。

### 工作流-Flow

行为树由多种不同类型的节点构成，它们都拥有一个共同的核心功能，即它们会返回三种状态中的一个作为结果。这三种状态分别是：

* 成功-Success；

* 失败-Failure；

* 运行中-Running；

前两个，正如它们的名字，是用来向它们的父节点通知运行的成功或失败的结果。第三种是指还在运行中，结果还未决定，在下一个 tick 的时候再去检查这个节点的运行结果。

### 数据上下文-Data Context

当一个行为树被调用时，一个数据上下文也被创建出来。

它的用途是存储被节点所解释和改变的变量。这些变量随后可以被节点结合着数据的上下文加以读写，从而使整个行为树保持为一个统一的整体。

## 插件

[Behavior Designer 中文版教程](https://www.jianshu.com/p/64b5fe01fb1c)
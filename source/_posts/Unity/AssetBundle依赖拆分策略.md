---
title: AssetBundle依赖拆分策略
categories: Unity
tags: AssetBundle
date: 2023-02-21 22:05:10
---

## 目的

关于AssetBundle依赖拆分一直是一个头疼的问题，但是目的也是很也是非常的明确。

- AssetBundle之间不要冗余资源
- 包体体积小
- 加载速度快
- 内存占用小

所以在项目制作开始就应该规划好，需要打包的文件夹。

## 拆分策略

### 所有资源都打成AssetBundle

实现：

实现也很简单，将所有使用的资源都以及依赖都打成单独的AssetBundle包

优点：

- 这种方法是最简单快捷的解决了资源冗余的问题，绝不会产生冗余
- 修改一个资源并不会影响到其他的资源
- 版本更新资源容量最小化

缺点

- AssetBundle文件会保存许多信息，所以AssetBundle包一旦过多文件信息也会过多，使得总量变大
- 由于文件过多导致玩家下载的资源数量也变多了，因为每个资源都需要建立新的连接来下载，下载速度也会变慢
- 文件加载的过程中需要加载各个AssetBundle的依赖，数量变多，加载速度也会变慢
- 加载是内存会变大，因为需要保存AssetBundle相关信息所以导致加载的内存也会变大

总结

虽然解决了资源冗余的问题，但是随之而来的问题确实无法避免，反而有些得不偿失，所以不建议使用这种资源管理方式

### 单独的个体所包含的依赖打成一个AssetBundle

实现：

查找出使用的资源所有的资源，打包的时候只打包使用的资源，不打包依赖文件，就能达到。

优点：

- 文件会比较少
- 资源更新下载的次数也会变少

缺点：

- 资源之间会产生比较多的冗余
- 所打的AssetBundle包只大不小
- 较多的冗余也会额外的分配内存，导致内存的浪费
- 修改的资源被很多物体引用，那么下次版本更新，也会随之更新所引用的物体，随之重新下载

总结

使用这种方式需要考虑的资源复用的情况多不多，如果资源多则不建议这样做（程序员也很难避免有这样），所以也不太推荐这种方式。

### 根据依赖数量来判断资源是否需要打成AssetBundle

实现：

把所有使用的资源全列出来，然后检查依赖的资源，如果依赖的资源只被当前资源引用，就不需要单独打AssetBundle，如果被两个或以上的资源引用，那么就需要将这个资源提取出来单独打包。

优点：

- 所打的AssetBundle资源包会比较少
- 也基本上能保证没有冗余文件

缺点

- 例如一个资源开始只会被一个预设用到，后来变成和另外一个资源共用了，那么打包的时候，为了把共用的资源分离出来，原预设和这个资源都需要重新打包。如果经常有这种情况出现，可能热更新时需要更新的文件会随着共用资源变多而越来越多

总结

总体来看第三种方式会比较麻烦，但是也必要合理，既能保证没有冗余文件，也能使打的资源包变少。

## 总结

AssetBundle的拆分策略也需要根据实际情况进行处理，因为需求在变化，所以策略也需要结合起来，所以在项目开始的时候就需要规划好资源的使用以及存放规则。

例如：项目制作的过程中使用重复的资源，此时就需要手动创建一个或多个公共的目录存放重复使用的资源。项目打包后使用也需要将这些资源常驻内存。

关于资源的管理还需要根据需求进行定制，例如：仅仅只能使用多大的内存，减少下载时间，减少加载速度，等等一系列需求。

所以最重要的就是在规划资源目录，以及资源使用规则上，只有从根本上减少问题，才能更好的管理资源。

## 参考

[Unity手游实战：从0开始SLG——资源管理系统-基础篇（四）AssetBundle 最佳实践 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/98081170)

[Unity的AssetBundle使用总结 - 爱码网 (likecs.com)](https://www.likecs.com/show-203959410.html#AssetBundle_44)

